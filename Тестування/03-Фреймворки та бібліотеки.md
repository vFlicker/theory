# Фреймворки та бібліотеки

## Jest

Універсальний фреймворк для тестування JavaScript. Він дозволяє тестувати проекти, які використовують React, TypeScript, Node.js, Angular, Vue та інші технології

-   Не потребує тривалого налаштування
-   Добре документований
-   Багате API для тестів
-   Паралельне виконання тестів
-   Показує покриття коду тестами «із коробки»

### Встановлення

```
npm install -DE jest
```

### Налаштування

При запуску Jest з аргументом цей аргумент інтерпретується як регулярний вираз для назв файлів із тестами. Таким чином, у нашому прикладі при виклику `npm run test:smoke` виконуються лише тести з іменами `*.smoke.test.js `, а при виклику `npm run test` — всі тести в проекті, у тому числі `*.smoke.test.js`

```json
{
    "scripts": {
        "test:smoke": "jest .smoke.test.js",
        "test": "jest"
    }
}
```

### Опції Jest CLI

-   `--onlyChanged` — запустити лише змінені файли в Git репозиторії
-   `--testNamePattern=<regex>` та `--testPathPattern=<regex>` — за замовчуванням Jest шукатиме файли тестів із певним патерном (`*.test.js` та `*.spec.js`) у всьому проекті. Але скориставшись цими опціями, можна розділити тести на групи та викликати їх окремими командами. Наприклад, тести контролерів та тести утилітарних функцій
-   `--watch` та `--watchAll` — запускати тести після кожної зміни файлу (для файлу, що змінився, або для всього проекту)

## React Testing Library

Набір допоміжних функцій, що дозволяє тестувати React-компоненти не покладаючись на їхню внутрішню реалізацію. Так як Node.js не вміє працювати з DOM, для тестування UI використовується `render` функція, яка створює схожу на DOM структуру, щоб можна було перевірити, що React працює правильно, але не використовувати для цього справжній DOM

### Приклади використання React Testing Library

```js
test("loads and displays greeting", async () => {
    // ARRANGE
    render(<Fetch url="/greeting" />);

    // ACT
    await userEvent.click(screen.getByText("Load Greeting"));
    await screen.findByRole("heading");

    // ASSERT
    expect(screen.getByRole("heading")).toHaveTextContent("hello there");
    expect(screen.getByRole("button")).toBeDisabled();
});
```

## SuperTest

Бібліотека Node.js, яка допомагає розробникам тестувати API. Розробники можуть використовувати SuperTest як окрему бібліотеку або з фреймворками тестування JavaScript, такими як Mocha або Jest

-   Керує запуском і зв'язуванням програми за вас, роблячи її доступною для отримання запитів
-   Додає метод `expect`, який дозволяє робити багато типових тверджень у відповіді без необхідності писати її самостійно

### Axios у порівнянні з SuperTest

```js
/**
 * Axios.
 */
import assert from "assert/strict"; // assert (вбудований модуль Node.js)

axios(whereAppIs + "/endpoint").then((res) => {
    assert.equal(res.statusCode, 200);
});

/**
 * SuperTest.
 */
request(app).get("/endpoint").expect(200);
```

### Приклади використання SuperTest

```js
/**
 * Приклад 1.
 *
 * Без використання додаткових бібліотек.
 */
request("https://dog.ceo")
    .get("/api/breeds/image/random")
    .expect(200)
    .expect("Content-Type", "application/json")
    .expect((res) => {
        if (!res.body.hasOwnProperty("status")) {
            throw new Error("Expected 'status' key!");
        }

        if (!res.body.hasOwnProperty("message")) {
            throw new Error("Expected 'message' key!");
        }
    })
    .end((err, res) => {
        if (err) throw err;
    });

/**
 * Приклад 2.
 *
 * З використанням assert (вбудованого модуля у Node.js).
 */
import assert from "node:assert/strict";

request("https://dog.ceo")
    .get("/api/breeds/image/random")
    .expect(200)
    .expect("Content-Type", "application/json")
    .expect((res) => {
        assert(res.body.hasOwnProperty("status"));
        assert(res.body.hasOwnProperty("message"));
    })
    .end((err, res) => {
        if (err) throw err;
    });

/**
 * Приклад 3.
 *
 * З використанням Jest.
 */
describe("Random Dog Image", () => {
    it("responds with expected JSON structure", async () => {
        const response = await request("https://dog.ceo").get(
            "/api/breeds/image/random"
        );

        expect(response.status).toBe(200);
        expect(response.header["content-type"]).toBe("application/json");

        const { status, message } = response.body;

        expect(status).toBe("success");
        expect(message).toBe("*");
    });
});
```
