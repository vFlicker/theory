## Proxy

Проксі — це обгортка навколо об'єкта, яка «за замовчуванням» перенаправляє операції над нею на об'єкт, але може перехоплювати їх. Проксіювати можна будь-який об'єкт, включаючи класи та функції

### Ми можемо перехоплювати

-   Читання (get), запис (set), видалення (deleteProperty) властивості
-   Виклик функції (apply)
-   Оператор new (пастка construct)
-   Багато інших операцій

### Приклади

1. Обгортка над об'єктом, `withDefaultValue`, якщо в об'єкті не буде потрібного ключа, ми повернемо значення «за замовчуванням»

```js
const withDefaultValue = (target, defaultValue = 0) => {
    return new Proxy(target, {
        get: (obj, prop) => (prop in obj ? obj[prop] : defaultValue),
    });
};
```

2. Обгортку над об'єктом, withoutHiddenProps, якщо в об'єкті ім'я ключа буде починатися з `_`, ми не будемо його показувати

```js
const withHiddenProps = (target, prefix = `_`) => {
    return new Proxy(target, {
        has: (obj, prop) => {
            return prop in obj && !prop.startsWith(prefix);
        },
        ownKeys: (obj) => {
            return Reflect.ownKeys(obj).filter(
                (item) => !item.startsWith(prefix)
            );
        },
        get: (obj, prop, receiver) => {
            return prop in receiver ? obj[prop] : undefined;
        },
    });
};
```

3. Можна зробити індекс для масиву, для більш швидкого пошуку id в масиві об'єктів

```js
const IndexedArray = new Proxy(Array, {
    construct(target, [args]) {
        const index = {};

        for (arg of args) index[arg.id] = arg;

        return new Proxy(new target(...args), {
            get(arr, prop) {
                switch (prop) {
                    case "push":
                        return (item) => {
                            index[item.id] = item;
                            arr[prop].call(arr, item);
                        };
                    case "findById":
                        return (id) => index[id];
                    default:
                        return arr[prop];
                }
            },
        });
    },
});

const users = new IndexedArray([
    { id: 11, name: "Vladilen", job: "Fullstack", age: 25 },
    { id: 22, name: "Elena", job: "Student", age: 22 },
    { id: 33, name: "Victor", job: "Backend", age: 23 },
    { id: 44, name: "Vasilisa", job: "Teacher", age: 24 },
]);
```
