# SSL/TSL

Комп'ютери надсилають пакети даних. Поки дані переходять від клієнта на сервер, їх можна перехопити і прочитати. Ця атака називається Man-in-the-Middle. Нічого критичного, якщо ці дані є загальнодоступною інформацією. Однак, якщо ми надаємо пароль, номер кредитної картки або конфіденційну адресу електронної пошти, то не можна дозволити будь-кому їх бачити.

Як сховати конфіденційну інформацію від сторонніх? Найпростіший спосіб — зашифрувати. В інтернет-мережах шифруванням даних керують протоколи SSL/TLS. Кожен з них є криптографічним протоколом, який шифрує дані та аутентифікує з'єднання під час переміщенні даних в інтернеті.

Протоколи SSL/TLS працює між прикладним і транспортним рівнями та надає послуги безпеки для протоколів верхнього рівня, таких як HTTP, SMTP, FTP та інших. Він встановлює безпечний канал між двома кінцевими точками, забезпечуючи конфіденційність, цілісність і автентичність даних, якими обмінюються між ними.

## SSL

SSL (Secure Sockets Layer) — був розроблений для підвищення безпеки електронної комерції. Він реалізований на прикладному рівні (Application Layer) поверх TCP/IP. Це дозволяє працювати без змін протоколам на вищому рівні, наприклад HTTP (протоколу передачі гіпертексту) або SMTP (протоколу електронної пошти).

SSL додає більше кроків на шляху надсилання даних від адресата до одержувача, тому він збільшує затримку отримання даних. Однак переваги безпеки варті того.

### Як працює SSL

Сертифікат SSL встановлюється на стороні сервера. Браузер показує, що програма захищена SSL. Користувачі бачать на початку веб-адреси https://, а не http://. Літера s означає «безпечний».

Коли браузер підключається до сервера із встановленим SSL-сертифікатом, то запускається протокол SSL/TLS. Цей протокол шифрує інформацію, що передається між браузером та сервером (або між двома серверами).

При використанні SSL зловмисник зможе дізнатися IP-адресу, номер порту і приблизну кількість даних, що передаються. Також він може визначити ім'я хоста, до якого підключений користувач, але не решту URL-адреси. Тому важлива інформація залишиться у безпеці.

1. SSL починає працювати після встановлення TCP-з'єднання, створюючи сеанс SSL.
2. Сервер надсилає свій сертифікат користувачеві разом з рядом специфікацій, що підтримуються (включаючи версію SSL/TLS, методи шифрування та інше).
3. Користувач перевіряє дійсність сертифіката, вибирає найвищий рівень шифрування, який може підтримуватись обома сторонами, та запускає безпечний сеанс із використанням цих методів. Існує велика кількість наборів методів із різним ступенем захисту.
4. Щоб гарантувати цілісність і справжність всіх повідомлень, що передаються, протоколи SSL і TLS також включають процес аутентифікації.

### Рівні захисту

За допомогою протоколу SSL власники веб-застосунків показують користувачам, що їх дані захищені.

#### Сертифікати SSL для перевірки домену

Сертифікати SSL для перевірки домену — це базовий рівень сертифікації SSL. Ідентифікація організації тут не перевіряється, тому підходять лише для тестових серверів та внутрішніх посилань.

#### Сертифікати SSL для перевірки організації

Цей сертифікат гарантує, що користувач підтвердив володіння доменним ім'ям та довів, що його компанія зареєстрована та несе юридичну відповідальність як бізнес. Такий сертифікат також підтверджує домен та назву компанії. Цей рівень автентифікації підходить для загальнодоступних веб-сайтів, які збирають особисті дані від користувачів. Такий сертифікат можуть отримати лише організації та компанії, але не фізичні особи.

#### SSL-сертифікати з розширеною перевіркою

SSL із розширеною перевіркою допомагає захистити користувачів від надання даних підробленому веб-сайту, який може бути використаний зловмисниками для фішингу. Такий SSL-сертифікат гарантує перевірку домену та компанії, а також кілька додаткових кроків перевірки. Це доводить, що сертифікат SSL належить зареєстрованій компанії.

## TSL

TLS (Transport Layer Security) — це просто оновлена, безпечніша версія SSL. TLS усуває деякі вразливості безпеки в більш ранніх протоколах SSL і заснований на спеціфікації SSL, що вже діє. Як єдиний захист TLS рідко використовують, частіше беруть зв'язок обох сертифікатів SSL/TLS. Така підтримка гарантує роботу з новими і старими пристроями.

TLS використовує як симетричне шифрування, так і шифрування з відкритим ключем для безпечного надсилання особистих даних, а також додає додаткові функції безпеки, такі як автентифікація та виявлення підробки повідомлень.

Протокол TLS надає три послуги

-   Шифрування — приховування даних від одного комп'ютера до іншого
-   Аутентифікація — автентифікація сервера та клієнта
-   Цілісність — Виявлення підміни

## Як надсилаються дані

### «Рукостискання» TCP

Оскільки TLS побудовано поверх TCP/IP, клієнт має спочатку завершити тристороннє встановлення зв'язку TCP із сервером.

### Ініціювання TLS

Клієнт повинен попередити сервер, що йому потрібне з'єднання TLS замість стандартного небезпечного з'єднання. Тому він надсилає повідомлення з описом версії протоколу TLS, а також методи шифрування.

### Сервер підтверджує протокол

Сервер перерве з'єднання, якщо він не підтримує технології, які запитують клієнт. Це може статися, якщо сучасний клієнт намагається зв'язатися зі старим сервером.

Якщо сервер підтримує запитану версію протоколу TLS та інші параметри, він відповість підтвердженням, SSL-сертифікатом (Private Key) та відкритим ключем (Public Key).

### Перевірте сертифікат

SSL-сертифікат сервера — це спосіб сервера сказати: «Так, я дійсно той, ким ви мене вважаєте». Якщо клієнт не вірить у справжність сертифіката, він перерве з'єднання, оскільки не хоче надсилати особисті дані самозванцю. Але якщо клієнт успішно перевірив сертифікат, він переходить до наступного кроку.

### Генерація загального ключа

У цьому моменті клієнту вже відомий відкритий ключ сервера. Тепер він може зашифрувати дані за допомогою відкритого ключа, а потім сервер може розшифрувати їх за допомогою SSL-ключа.

```
Шифрування з відкритим ключем займає набагато більше часу, ніж симетричне шифрування. Симетричне шифрування — це коли один і той самий ключ використовується для шифрування та дешифрування. Це відбувається із-за більш складних арифметичних операцій. За можливістю віддають перевагу використовувати симетричне шифрування для економії часу.

комп'ютери можуть спочатку використовувати шифрування з відкритим ключем, щоб у приватному порядку створити загальний ключ, а потім вони можуть використовувати симетричне шифрування з цим ключем у майбутніх повідомленнях. Точний метод створення ключа залежить від обраного шифронабору. Найпоширеніші з них — RSA та Діффі-Хеллман.
```

Клієнт починає процес відправлення повідомлення на сервер з попереднім ключем (Pre-Master Secret), зашифрованим відкритим ключем сервера. Клієнт обчислює загальний ключ на основі цього попереднього ключа (оскільки це безпечніше, ніж відправлення фактичного загального ключа) і запам'ятовує спільний ключ локально.

Клієнт також надсилає повідомлення «Готово», вміст якого зашифрований за допомогою загального ключа.

### Сервер підтверджує загальний ключ

Тепер сервер може обчислити загальний ключ на основі попереднього загального ключа та спробувати розшифрувати повідомлення «Готово» за допомогою цього ключа. У разі збою з'єднання переривається.

Якщо сервер розшифрував повідомлення клієнта за допомогою спільного ключа, він надсилає підтвердження та власне повідомлення «Готово» із зашифрованим вмістом.

### Надсилання захищених даних

Тепер клієнт за допомогою симетричного шифрування та загального ключа безпечно надсилає особисті дані на сервер.

Часто одному й тому клієнту необхідно відправляти дані на сервер кілька разів. Наприклад, коли користувач заповнює форми на кількох сторінках веб-сайту. У цьому випадку комп'ютери можуть використовувати скорочений процес для встановлення безпечного сеансу.
