# WebSockets

WebSocket — це протокол, який забезпечує двосторонній зв'язок між клієнтом і сервером через єдине, постійно відкрите TCP-з'єднання. Це дозволяє обом сторонам відправляти дані в будь-який час. WebSocket є корисним для сценаріїв, де потрібно встановити постійне з'єднання для обміну даними в реальному часі, такими як чати, онлайн-ігри, онлайн-трансляції тощо.

## Принцип роботи

1. Встановлення з'єднання: Клієнт ініціює з'єднання WebSocket, включаючи заголовок `Upgrade: websocket` в HTTP-запиті. Це може бути виконано за допомогою URL-адреси, що починається з `ws://` або `wss://` для захищеного з'єднання.
2. «Рукостискання» (Handshake): Якщо сервер підтримує WebSocket, він відповідає кодом статусу 101 «Перемикання протоколу» та включає заголовок `Connection: Upgrade` та `Upgrade: websocket` у своїй відповіді. Це підтверджує зміну протоколу на WebSocket.
3. З'єднання встановлено: Після «рукостискання» з'єднання WebSocket встановлено і готове для обміну даними.
4. Обмін даними: Тепер і клієнт, і сервер можуть надсилати повідомлення один одному у вигляді даних у бінарному або текстовому форматі. Цей обмін даними відбувається в реальному часі без необхідності створювати нові HTTP-запити для кожного повідомлення.
5. Закриття з'єднання: Клієнт або сервер можуть ініціювати закриття WebSocket-з'єднання, надсилаючи відповідне повідомлення. Після закриття з'єднання воно більше не може бути використане.

## Створення WebSocket сервера за допомогою Node.js

### Створення простого WebSocket сервера

```js
const WebSocket = require("ws");

const server = new WebSocket.Server({ port: 8080 });

server.on("connection", (socket) => {
    console.log("Нове з'єднання встановлено");

    // Відправка повідомлення клієнту
    socket.send("Ласкаво просимо до WebSocket сервера!");

    // Обробка повідомлень від клієнта
    socket.on("message", (message) => {
        console.log(`Отримано повідомлення: ${message}`);

        // Відправка відповіді клієнту
        socket.send(`Ви сказали: ${message}`);
    });

    // Обробка закриття з'єднання
    socket.on("close", () => {
        console.log("З'єднання закрито");
    });
});

console.log("WebSocket сервер запущено на порті 8080");
```

### Створення WebSocket клієнта

```js
const WebSocket = require("ws");

const socket = new WebSocket("ws://localhost:8080");

socket.on("open", () => {
    console.log("Підключено до сервера");

    // Відправка повідомлення серверу
    socket.send("Привіт, сервер!");
});

socket.on("message", (message) => {
    console.log(`Отримано повідомлення від сервера: ${message}`);
});

socket.on("close", () => {
    console.log("З'єднання з сервером закрито");
});
```

### Створення WebSocket з'єднання в браузері

```js
const socket = new WebSocket("ws://localhost:8080");

// Відкриття з'єднання
socket.addEventListener("open", (event) => {
    console.log("Підключено до сервера");
    socket.send("Привіт, сервер!");
});

// Отримання повідомлення від сервера
socket.addEventListener("message", (event) => {
    console.log(`Отримано повідомлення: ${event.data}`);
});

// Закриття з'єднання
socket.addEventListener("close", (event) => {
    console.log("З'єднання закрито");
});

// Обробка помилок
socket.addEventListener("error", (event) => {
    console.error("Помилка з'єднання:", event);
});
```
