# Модулі

NPM (Node Package Manager / Менеджер пакетів Node.js) — це програма для управління пакетами та залежностями у проектах, що розробляються на основі Node.js.

## Навіщо потрібен пакетний менеджер

- Перевикористання коду.
- Автоматизація стандартних операцій у проекті.
- Зручність відстеження змін та оновлень.
- Поділ коду на модулі.

## Модуль

- Ізолює простір імен.
- Описує залежності.
- Описує зовнішнє API (що надається ззовні).

## Завантажувач модулів

- Шукає модуль.
- Завантажує модуль за необхідністю.
- Кешує вже завантажені модулі.

## Особливості `require`

- `this` посилається на `module.exports`.
- Коли Node.js зустрічає вбудовану функцію `require`, він інтерпретує рядок, переданий як шлях до модуля, який потрібно завантажити.
- Модуль завантажується рівно один раз — його результат кешується.
- Node.js завжди використовує UNIX-style шляхи (за `/`).
- Розширення файлу можна опустити.
- Якщо вказати папку з модулем, Node.js спробує завантажити `index.js` з цієї папки.
- `require.main === module` повертає `true` тільки для вхідного модуля (точка входу).

## Алгоритм завантаження модулів

1. Якщо шлях збігається з ім'ям вбудованого модуля, завантажити його.
2. Якщо шлях починається з `/`, завантажити модуль за абсолютним шляхом.
3. Якщо шлях починається з `./` або `../`
   - Спробувати завантажити як файл відносно поточного модуля.
   - Спробувати завантажити як директорію.
4. Спробувати завантажити як залежність.
5. Викинути помилку, якщо модуль не знайдено.

## Область видимості модуля

- `module` — об'єкт, що описує поточний модуль.
- `exports` — посилання на об'єкт `module.exports`.
- `require` — функція, яка підключає модулі.
- `__filename` — абсолютний шлях до модуля.
- `__dirname` — абсолютний шлях до директорії, де знаходиться модуль.

## Module wrapper (модульна обгортка)

```js
function load(info) {
  const module = {
    exports: {},
    require: (path) => {
      /* ... */
    },
  };

  ((exports, require, module, __filename, __dirname) => {
    module.exports = {
      // Файл mother.js
      name: `Мама`,
      age: 12,
      male: false,
    };

    exports.name = `Оксана`;
  })(module.exports, module.require, module);

  return module.exports;
}
```

## Обмеження модулів

- Ніколи не кладіть об'єкт у змінну `exports`, краще використовуйте `module.exports`.
- Ніколи не експортуйте значення асинхронно чи всередині умов, оскільки вони можуть виявитися непроініціалізовані.
- Розширення файлу для залежностей можна опустити.
- Уникайте циклічних залежностей.
