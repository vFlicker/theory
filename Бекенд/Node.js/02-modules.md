## Modules

NPM (Node Package Manager / Менеджер пакетів ноди) — програма для управління пакетами та залежностями для програм, що розробляються на базі Node.js

### Навіщо потрібний пакетний менеджер

-   Перевикористання коду
-   Автоматизація стандартних операцій у проекті
-   Зручність відстеження змін та оновлень
-   Поділ коду на модулі

### Модуль

-   Ізолює простір імен
-   Описує залежності
-   Описує те, що він надає назовні

### Завантажувач модулів

-   Шукає модуль
-   Завантажує модуль на вимогу
-   Кешує вже завантажені модулі

### Особливості require

-   `this` буде мати посилання на `module.exports`
-   Коли Node.js зустрічає вбудовану функцію require він інтерпретує рядок, який в неї передали як шлях до модуля, який потрібно завантажити
-   Модуль завантажується рівно один раз. Після того як Node.js одного разу завантажив модуль — він його кешує (зберігає результат виконання модуля), тобто, ніякий модуль не буде завантажений та виконаний двічі, неважливо скільки разів він був підключений
-   Node.js завжди використовує UNIX-style шляхи (через /)
-   Шляхи в реєстрозалежних та реєстрозалежних файлових системах поводяться по різному. Більше того в реєстронезалежних системах по-різному завантажені модулі можуть призводити до повторного завантаження модуля
-   Розширення файлу можна опустити
-   Якщо послатися на папку з модулем index.js, то Node.js підключить завантажити цей модуль із папки
-   Вираз require.main === module — поверне true тільки в тому випадку, якщо цей модуль був вхідним файлом (точкою входу)

### Алгоритм завантаження модулів

1. Якщо шлях збігається з ім'ям вбудованого модуля
    1. Завантажити модуль
2. Якщо шлях починається з '/'
    1. Завантажити модуль по абсолютному шляху
3. Якщо шлях починається з './' або '../'
    1. Спробувати завантажити як файл щодо поточного модуля
    2. Спробувати завантажити як директорію
4. Спробувати завантажити як залежність
5. Викинути помилку, що такий модуль не знайдено

### Область видимості модуля

-   module — об'єкт, що описує поточний модуль
-   exports — посилання на об'єкт module.exports
-   require — функція, яка підключає модулі
-   \_\_filename — абсолютний шлях до модуля
-   \_\_dirname — абсолютний шлях до директорії в якій лежить модуль

### Module wrapper (модульна обгортка)

```js
function load(info) {
    const module = {
        exports: {},
        require: (path) => {
            /* ... */
        },
    };

    ((exports, require, module, __filename, __dirname) => {
        module.exports = {
            // Файл mother.js
            name: `Мама`,
            age: 12,
            male: false,
        };

        exports.name = `Оксана`;
    })(module.exports, module.require, module);

    return module.exports;
}
```

### Обмеження модулів

-   Ніколи не кладіть об'єкт у змінну exports, краще використовувати module.exports
-   Ніколи не експортуйте значення асинхронно чи всередині умов, тому що вони можуть виявитися непроініціалізовані
-   Розширення файлу у залежності можна опустити
-   Уникайте циклів
