## MongoDB

MongoDB — документоорієнтована система управління базами даних (СУБД) з відкритим вихідним кодом, схеми таблиць, що не потребує опису

### Особливості MongoDB

-   JSON-подібне сховище (документ)
-   Масштабованість
-   Доступність (може буде розміщена не де-кількох серверах, що дає декілька точок відмови)
-   Просунуті техніки індексації (текст, координати, дати)
-   Eventually consistency (узгодженість у кінцевому рахунку) — це гарантія того, що коли оновлення здійснюється в розподіленій базі даних, це оновлення в кінцевому підсумку буде відображено на всіх вузлах, які зберігають дані, що призводить до однакової відповіді кожного разу, коли дані запитуються
-   Файлове сховище
-   Зручний клієнт з зручним API

### Запуск MongoDB сервера

-   Створити директорію, де зберігатимуться дані
-   Вказати порт `--port 27017`
-   Вказати шлях до директорії `--dbpath=./data`
-   Запустити сервер `mongod --port 27017 --dbpath=./data`

### Клієнт для роботи з базою даних

-   Підключається до БД
-   Слідкує за підключенням до бази даних
-   Працює за внутрішнім протоколом роботи з БД
-   Надає зручний API для розробника

### Базові поняття (у контексті MongoDB)

-   Database (база даних) — один сервер баз даних може містити декілька баз даних, звернення до конкретної бази відбувається за допомогою вказівки імені бази даних
-   Collection (колекція) — набір однотипних даних у БД (таблиця), наприклад — колекція магів, колекція фото, колекція користувачів
-   Курсор (cursor) — ітератор (див. іterator в патернах), який дозволяє обмежувати чи керувати даними при їх отриманні

### Базові операції в MongoDB

Читання — `find()`

-   Приймає на вхід об'єкт запиту у вигляді JSON
-   Повертає Cursor із отриманими даними

Запис — `insertOne()`, `insertMany()`

-   insertOne — приймає на вхід об'єкт та записує його до колекції
-   insertMany — приймає на вхід масив об'єктів і записує їх у колекцію по одному
-   Повертає об'єкт із результатом операції, якщо все добре
-   Викидає помилку, якщо запит некоректний або виникла помилка

Оновлення — `updateOne()`, `updateMany()`

-   Приймає на вхід два об'єкти — один запит, інший об'єкт та параметри оновлення
-   Повертає об'єкт із результатом операції, якщо все добре
-   Викидає помилку, якщо запит некоректний або виникла помилка

Видалення — `deleteOne()`, `deleteMany()`

-   Приймає на вхід об'єкт запиту
-   Повертає об'єкт із результатом операції, якщо все добре
-   Викидає помилку, якщо запит некоректний або виникла помилка

### Selector (об'єкт запиту )

Являє собою шаблон об'єкту який ми шукаємо, `{ name: "Пендальф" }` слід читати як

-   Знайди в колекції об'єкти, у яких є поле name
-   Відфільтруй серед них ті об'єкти, значення поля name яких дорівнює Пендальф
-   Підтримує складніші запити

### GridFS

Розподілена файлова система, зроблена поверх MongoDB і вбудована прямо в СУБД MongoDB

-   Автоматично розбиває дані на частини (chunks)
-   Має дуже просто інтерфейс, заснований на fs.Stream
-   openUploadStream — створює WriteStream в який можна писати дані
-   openDownloadStreamByName -— створює ReadStream з якого можна прочитати дані

### Підключення

```js
const { MongoClient } = require("mongodb");

const url = "mongodb://localhost:27017";

const connectAndRead = async () => {
    const client = await MongoClient.connect(url);
    const db = client.db("my-fancy-game");
    const collection = db.collection("wizards");
    client.close();
};

connectAndRead().catch((e) => {
    throw e;
});
```
