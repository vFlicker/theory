# Копіювання під час запису (Copy-On-Write)

Копіювання під час запису — це техніка оптимізації використання ресурсів, яка дозволяє економити пам'ять та збільшувати продуктивність шляхом спільного використання копії ресурсу та його оригіналу, доки ресурс не зазнає змін. Копіювання відбувається лише при спробі модифікації ресурсу.

Основна ідея полягає в тому, що коли ресурс не змінюється, не створюється нова копія, а використовується вже існуюча. Це дозволяє зменшити накладні витрати на створення та знищення зайвих копій. Однак, якщо ресурс потребує зміни, тоді створюється його копія, і подальші модифікації відбуваються вже у цій копії.

Техніка копіювання під час запису дозволяє ефективно використовувати ресурси, зменшуючи необхідність у створенні зайвих копій. Вона особливо корисна, коли ресурси є об'ємними або обмеженими за доступом.

Для успішної реалізації цієї техніки важливо правильно керувати доступом до ресурсів, синхронізувати потоки виконання та відстежувати зміни стану ресурсу. Використання відповідних алгоритмів і структур даних сприяє ефективному впровадженню копіювання під час запису.

Застосування цієї техніки має велике значення в багатьох областях, таких як бази даних, операційні системи, алгоритми обробки даних та інші, де ефективне використання ресурсів є важливою задачею.

## Приклад реалізації у мові програмування Swift

Приведений приклад у мові програмування Swift ілюструє механізм копіювання під час запису. Він показує, що коли масив arr2 створюється як копія arr1, вони починають спільно використовувати одну і ту саму пам'ять. Проте, коли в arr2 відбувається зміна, механізм копіювання під час запису створює нову копію arr1 і змінює її, зберігаючи оригінальний arr1 без змін. Це дозволяє економити пам'ять та зберігати консистентність даних.

```swift
var arr1 = [1, 2, 3]
var arr2 = arr1

address(arr1) // адреса: 105553154755744
address(arr2) // адреса: 105553154755744

arr2.append(4)

address(arr1) // адреса: 105553154755744
address(arr2) // адреса: 105553135788672
```
